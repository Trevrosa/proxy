<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>proxy</title>
</head>

<body>
    <noscript>This site requires JavaScript!</noscript>
    <p id="msg">proxy</p>

    <script lang="javascript">
        const params = new URLSearchParams(window.location.search);
        const back = params.get("back");

        if (back != null) {
            document.getElementById("msg").innerText = "installing service worker, wait..";

            navigator.serviceWorker.register("sw.js", { scope: "." }).then(async (_reg) => {
                console.log("service worker registered");

                await window.cookieStore.set("trev-proxy-service-worker-installed", "true");

                window.location.replace(`./proxy/${back}`)
            }, (err) => {
                console.error(`service worker failed to register: ${err}`);
            });
        } else if (params.get("reset") != null) {
            window.cookieStore.delete("trev-proxy-service-worker-installed")
        }
    </script>
</body>

</html>